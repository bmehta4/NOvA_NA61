\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight}{\section{Neutrino\-Flux\-Auxiliar\-:\-:Nu\-Weight Class Reference}
\label{class_neutrino_flux_auxiliar_1_1_nu_weight}\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
}


Get the weight to get the neutrino probability flux in one point.  




{\ttfamily \#include $<$Nu\-Weight.\-h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a8b1c902f732e7be8d3591e74c807fb3c}{Nu\-Weight} (std\-::vector$<$ double $>$ \&posdet)
\begin{DoxyCompactList}\small\item\em The constructor has to have the position of the detector. \end{DoxyCompactList}\item 
\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a1ee7ff5745a68e9595751fd4f16b66ec}{$\sim$\-Nu\-Weight} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
void \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_ac6b650be51f799539e2f5ddddf3256ba}{calculate\-\_\-weight} (bsim\-::\-Dk2\-Nu $\ast$nu)
\begin{DoxyCompactList}\small\item\em Calculate weight based on dk2nu entry. After this, enu and wgt have meaningful values. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
double \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}{enu}
\item 
double \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a53e3e4d489356d71c6493e9e4ae11250}{wgt}
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
T\-Database\-P\-D\-G $\ast$ \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aa35fc1d624cd975a9657f1a081a776ca}{particle}
\item 
double \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a9ea8df1e61c18a5a795746c182c31a5a}{xdet}
\item 
double \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4041206ba690070b210e5d8b28497c56}{ydet}
\item 
double \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4e33b89875dd565737b9a35e201b4585}{zdet}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Get the weight to get the neutrino probability flux in one point. 

Definition at line 19 of file Nu\-Weight.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_a8b1c902f732e7be8d3591e74c807fb3c}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!Nu\-Weight@{Nu\-Weight}}
\index{Nu\-Weight@{Nu\-Weight}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{Nu\-Weight}]{\setlength{\rightskip}{0pt plus 5cm}Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::\-Nu\-Weight (
\begin{DoxyParamCaption}
\item[{std\-::vector$<$ double $>$ \&}]{posdet}
\end{DoxyParamCaption}
)}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_a8b1c902f732e7be8d3591e74c807fb3c}


The constructor has to have the position of the detector. 



Definition at line 7 of file Nu\-Weight.\-cpp.


\begin{DoxyCode}
7                                              \{
8     
9     \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aa35fc1d624cd975a9657f1a081a776ca}{particle} = TDatabasePDG::Instance();
10     \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}{NuWeight::enu}  = -1.0;
11     \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a53e3e4d489356d71c6493e9e4ae11250}{NuWeight::wgt}  = -1.0;
12     \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a9ea8df1e61c18a5a795746c182c31a5a}{xdet} = posdet[0];
13     \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4041206ba690070b210e5d8b28497c56}{ydet} = posdet[1];    
14     \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4e33b89875dd565737b9a35e201b4585}{zdet} = posdet[2];
15   \}
\end{DoxyCode}
\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_a1ee7ff5745a68e9595751fd4f16b66ec}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!$\sim$\-Nu\-Weight@{$\sim$\-Nu\-Weight}}
\index{$\sim$\-Nu\-Weight@{$\sim$\-Nu\-Weight}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{$\sim$\-Nu\-Weight}]{\setlength{\rightskip}{0pt plus 5cm}Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::$\sim$\-Nu\-Weight (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_a1ee7ff5745a68e9595751fd4f16b66ec}


Destructor. 



Definition at line 118 of file Nu\-Weight.\-cpp.


\begin{DoxyCode}
118                      \{ 
119   \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_ac6b650be51f799539e2f5ddddf3256ba}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!calculate\-\_\-weight@{calculate\-\_\-weight}}
\index{calculate\-\_\-weight@{calculate\-\_\-weight}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{calculate\-\_\-weight}]{\setlength{\rightskip}{0pt plus 5cm}void Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::calculate\-\_\-weight (
\begin{DoxyParamCaption}
\item[{bsim\-::\-Dk2\-Nu $\ast$}]{nu}
\end{DoxyParamCaption}
)}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_ac6b650be51f799539e2f5ddddf3256ba}


Calculate weight based on dk2nu entry. After this, enu and wgt have meaningful values. 



Definition at line 16 of file Nu\-Weight.\-cpp.


\begin{DoxyCode}
16                                               \{
17      \textcolor{comment}{//assumes units are GeV and cm}
18 
19     \textcolor{keywordtype}{int} likely\_ion = 100000000;
20     \textcolor{keywordtype}{double} mpar=-1.;
21     \textcolor{keywordtype}{int} size = (nu->ancestor).size();
22     \textcolor{keywordtype}{int} pdg = nu->ancestor[size-2].pdg;
23 
24     \textcolor{keywordflow}{if}(pdg>likely\_ion || pdg<-1*likely\_ion)\{
25       std::cout<< \textcolor{stringliteral}{"Not handling ions yet, pdg: "}<<pdg<<std::endl;
26       exit (1);
27     \}
28     \textcolor{keywordflow}{else}\{
29       mpar = \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aa35fc1d624cd975a9657f1a081a776ca}{particle}->GetParticle(pdg)->Mass();
30     \}
31     
32     \textcolor{keywordtype}{double} ppar  = sqrt( pow(nu->decay.pdpx,2) + pow(nu->decay.pdpy,2) + pow(nu->decay.pdpz,2) );
33     \textcolor{keywordtype}{double} epar  = sqrt(pow(ppar,2)+pow(mpar,2));
34     \textcolor{keywordtype}{double} gamma = epar / mpar;
35     \textcolor{keywordtype}{double} beta = sqrt(pow(gamma,2)-1)/gamma;
36 
37     \textcolor{keywordtype}{double} rr = sqrt(pow(\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a9ea8df1e61c18a5a795746c182c31a5a}{xdet}-nu->decay.vx,2)+pow(\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4041206ba690070b210e5d8b28497c56}{ydet}-nu->decay.vy,2)+pow(
      \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4e33b89875dd565737b9a35e201b4585}{zdet}-nu->decay.vz,2));
38     \textcolor{keywordtype}{double} cos\_theta = ( (nu->decay.pdpx)*(\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a9ea8df1e61c18a5a795746c182c31a5a}{xdet}-nu->decay.vx) + (nu->decay.pdpy)*(
      \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4041206ba690070b210e5d8b28497c56}{ydet}-nu->decay.vy) + (nu->decay.pdpz)*(\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4e33b89875dd565737b9a35e201b4585}{zdet}-nu->decay.vz) )/ (ppar*rr);
39  
40     \textcolor{keywordflow}{if}(cos\_theta > 1 || cos\_theta < -1)\{
41       std::cout<< \textcolor{stringliteral}{"Cosine of neutrino not allowed: "}<<cos\_theta<<std::endl;
42       exit (1);
43     \}
44     \textcolor{keywordtype}{double} MM      = 1.0/(gamma*(1.0-beta*cos\_theta));
45     \textcolor{keywordtype}{double} angdet  = (pow(\hyperlink{_nu_weight_8cpp_ae7afe156db7f7ccfcf48729eb3817b69}{rdet},2) /pow(rr,2)/ 4.); 
46     \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}{NuWeight::enu}  =  MM*(nu->decay.necm);
47     \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a53e3e4d489356d71c6493e9e4ae11250}{NuWeight::wgt}  = angdet * pow(MM,2);
48  
49     \textcolor{comment}{//done for all except polarized muon}
50     \textcolor{comment}{// in which case need to modify weight}
51     \textcolor{keywordflow}{if} (pdg == 13 || pdg == -13)\{
52 
53       \textcolor{comment}{//boost new neutrino to mu decay cm}
54       \textcolor{keywordtype}{double} vbeta[3];
55       vbeta[0] = nu->decay.pdpx / epar;
56       vbeta[1] = nu->decay.pdpy / epar;
57       vbeta[2] = nu->decay.pdpz / epar;
58 
59       \textcolor{keywordtype}{double} p\_nu[3]; \textcolor{comment}{//nu momentum    }
60       p\_nu[0] = (\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a9ea8df1e61c18a5a795746c182c31a5a}{xdet}- nu->decay.vx) * (\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}{NuWeight::enu}) / rr;
61       p\_nu[1] = (\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4041206ba690070b210e5d8b28497c56}{ydet}- nu->decay.vy) * (\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}{NuWeight::enu}) / rr;
62       p\_nu[2] = (\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_a4e33b89875dd565737b9a35e201b4585}{zdet}- nu->decay.vz) * (\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}{NuWeight::enu}) / rr;
63 
64       \textcolor{keywordtype}{double} partial = gamma*(vbeta[0]*p\_nu[0]+vbeta[1]*p\_nu[1]+vbeta[2]*p\_nu[2]);
65       partial = (\hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}{NuWeight::enu})-partial / (gamma+1.);
66 
67       \textcolor{keywordtype}{double} p\_dcm\_nu[4];
68       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<3;i++) p\_dcm\_nu[i]=p\_nu[i]-vbeta[i]*gamma*partial;
69       p\_dcm\_nu[3]=0.;
70       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<3;i++) p\_dcm\_nu[3]+=p\_dcm\_nu[i]*p\_dcm\_nu[i];
71       p\_dcm\_nu[3]=sqrt(p\_dcm\_nu[3]);
72 
73       \textcolor{comment}{//boost parent of mu to mu production cm}
74       gamma   = nu->decay.ppenergy / mpar;
75       vbeta[0] = nu->decay.ppdxdz * nu->decay.pppz / nu->decay.ppenergy;
76       vbeta[1] = nu->decay.ppdydz * nu->decay.pppz / nu->decay.ppenergy;
77       vbeta[2] =                    nu->decay.pppz / nu->decay.ppenergy;
78       partial = gamma*(vbeta[0]*nu->decay.muparpx+vbeta[1]*nu->decay.muparpy+vbeta[2]*nu->decay.muparpz);
79       partial = nu->decay.mupare - partial / (gamma+1.);
80 
81       \textcolor{keywordtype}{double} p\_pcm\_mp[4];
82       p\_pcm\_mp[0]=nu->decay.muparpx-vbeta[0]*gamma*partial;
83       p\_pcm\_mp[1]=nu->decay.muparpy-vbeta[1]*gamma*partial;
84       p\_pcm\_mp[2]=nu->decay.muparpz-vbeta[2]*gamma*partial;
85       p\_pcm\_mp[3]=0.;
86       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<3;i++) p\_pcm\_mp[3]+=p\_pcm\_mp[i]*p\_pcm\_mp[i];
87       p\_pcm\_mp[3]=sqrt(p\_pcm\_mp[3]);
88 
89       \textcolor{keywordtype}{double} wt\_ratio = 1.;
90       \textcolor{comment}{//have to check p\_pcm\_mp}
91       \textcolor{comment}{//it can be 0 if mupar..=0. (I guess muons created in target??)}
92       \textcolor{keywordflow}{if} (p\_pcm\_mp[3] != 0. ) \{
93         \textcolor{comment}{//calc new decay angle w.r.t. (anti)spin direction}
94         \textcolor{keywordtype}{double} costh = (p\_dcm\_nu[0]*p\_pcm\_mp[0]+ 
95                         p\_dcm\_nu[1]*p\_pcm\_mp[1]+ 
96                         p\_dcm\_nu[2]*p\_pcm\_mp[2])/(p\_dcm\_nu[3]*p\_pcm\_mp[3]);
97 
98         \textcolor{keywordflow}{if} (costh>1.) costh = 1.;
99         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (costh<-1.) costh = -1.;
100 
101         \textcolor{comment}{//calc relative weight due to angle difference}
102         \textcolor{keywordflow}{if}(nu->decay.ntype == 12 || nu->decay.ntype == -12)\{
103           wt\_ratio = 1.-costh;
104         \}
105         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(nu->decay.ntype == 14 || nu->decay.ntype == -14)\{
106           \textcolor{keywordtype}{double} mumass = \hyperlink{class_neutrino_flux_auxiliar_1_1_nu_weight_aa35fc1d624cd975a9657f1a081a776ca}{particle}->GetParticle(13)->Mass(); 
107           \textcolor{keywordtype}{double} xnu = 2.* nu->decay.necm / mumass;
108           wt\_ratio = ( (3.-2.*xnu) - (1.-2.*xnu)*costh ) / (3.-2.*xnu);
109         \} \textcolor{keywordflow}{else} \{
110           std::cout << \textcolor{stringliteral}{"NuWeight:: Bad neutrino type"}<<std::endl;
111         \}
112       \}
113       NuWeight::wgt *= wt\_ratio;
114     \}
115 
116   \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!enu@{enu}}
\index{enu@{enu}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{enu}]{\setlength{\rightskip}{0pt plus 5cm}double Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::enu}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_aaf30ef23c7cf98ecbda310a777d0b8aa}


Definition at line 30 of file Nu\-Weight.\-h.

\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_aa35fc1d624cd975a9657f1a081a776ca}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!particle@{particle}}
\index{particle@{particle}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{particle}]{\setlength{\rightskip}{0pt plus 5cm}T\-Database\-P\-D\-G$\ast$ Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::particle\hspace{0.3cm}{\ttfamily [private]}}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_aa35fc1d624cd975a9657f1a081a776ca}


Definition at line 34 of file Nu\-Weight.\-h.

\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_a53e3e4d489356d71c6493e9e4ae11250}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!wgt@{wgt}}
\index{wgt@{wgt}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{wgt}]{\setlength{\rightskip}{0pt plus 5cm}double Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::wgt}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_a53e3e4d489356d71c6493e9e4ae11250}


Definition at line 31 of file Nu\-Weight.\-h.

\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_a9ea8df1e61c18a5a795746c182c31a5a}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!xdet@{xdet}}
\index{xdet@{xdet}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{xdet}]{\setlength{\rightskip}{0pt plus 5cm}double Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::xdet\hspace{0.3cm}{\ttfamily [private]}}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_a9ea8df1e61c18a5a795746c182c31a5a}


Definition at line 35 of file Nu\-Weight.\-h.

\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_a4041206ba690070b210e5d8b28497c56}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!ydet@{ydet}}
\index{ydet@{ydet}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{ydet}]{\setlength{\rightskip}{0pt plus 5cm}double Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::ydet\hspace{0.3cm}{\ttfamily [private]}}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_a4041206ba690070b210e5d8b28497c56}


Definition at line 36 of file Nu\-Weight.\-h.

\hypertarget{class_neutrino_flux_auxiliar_1_1_nu_weight_a4e33b89875dd565737b9a35e201b4585}{\index{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}!zdet@{zdet}}
\index{zdet@{zdet}!NeutrinoFluxAuxiliar::NuWeight@{Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight}}
\subsubsection[{zdet}]{\setlength{\rightskip}{0pt plus 5cm}double Neutrino\-Flux\-Auxiliar\-::\-Nu\-Weight\-::zdet\hspace{0.3cm}{\ttfamily [private]}}}\label{class_neutrino_flux_auxiliar_1_1_nu_weight_a4e33b89875dd565737b9a35e201b4585}


Definition at line 37 of file Nu\-Weight.\-h.



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
include/\hyperlink{_nu_weight_8h}{Nu\-Weight.\-h}\item 
src/\hyperlink{_nu_weight_8cpp}{Nu\-Weight.\-cpp}\end{DoxyCompactItemize}
